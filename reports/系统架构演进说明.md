# 系统架构演进说明

## 现状概述
- 框架：Hexo 7 + 主题 anzhiyu（Pug/Stylus/JS）。
- 部署：Vercel 静态构建（`public`）。
- 逻辑：主题脚本（helpers/filters/tags）与前端主脚本 `themes/anzhiyu/source/js/main.js`。

## 演进思路（非侵入式）
- 站点级生命周期扩展：在 Hexo `after_render` 阶段做统一增强（图片、资源注入）。
- 前端运行时补丁：通过全站注入 JS，在不修改主题文件前提下补全功能与修复缺陷。

## 本次演进
- 新增模块：
  - `scripts/after_render.js`：统一优化输出 HTML 内容与注入资源。
  - `source/js/patches.js`：运行时修复输入态判断，增强交互稳定性。
- 测试与度量：引入 `vitest` 与 Lighthouse CI 测量体系；新增 `tests` 与 `reports`。

## 后续演进路线
- 资源管线：引入图片处理（生成多尺寸与 WebP），在 `after_render` 中生成/替换。
- 监控与可观测性：接入 RUM（HTTPS），度量交互延迟与错误率。
- 自动化：CI 集成构建、测试与性能门槛（`lhci assert`）。